{"version":3,"file":"fractals.es.js","sources":["../src/fractal.js"],"sourcesContent":["/** @module Fractal */\n\n/**\n * @typedef {number[]} FractalColor\n */\n\n/**\n * @typedef {FractalColor[][]} FractalFigure\n */\n\n/**\n * @typedef {Object} FractalIteration\n * @property {number} ratio\n * @property {number} countX\n * @property {number} countY\n */\n\n/** @type FractalColor */\nconst defaultColor = [255, 255, 255];\n\n/** @type FractalFigure */\nconst defaultFigure = [[defaultColor]];\n\n\n/** @class */\nexport default class Fractal {\n  /**\n   * @param {HTMLCanvasElement} selector\n   * @param {FractalFigure} figure\n   * @param {FractalColor} bg\n   * @param {number} ratio\n   */\n  constructor(selector, figure, bg = [0, 0, 0], ratio = 2) {\n    const canvas = selector instanceof HTMLCanvasElement\n      ? selector\n      : document.querySelector(selector);\n\n    this.canvas = canvas;\n    this.ctx = canvas.getContext('2d');\n    this.ctx.globalCompositeOperation = 'multiply';\n\n    if (!figure) figure = defaultFigure;\n\n    this.params = {\n      width: canvas.offsetWidth,\n      height: canvas.offsetHeight,\n      ratio, bg, figure\n    };\n\n    canvas.width = this.params.width;\n    canvas.height = this.params.height;\n\n    this.clear();\n  }\n\n  get bg() {\n    return this.params.bg;\n  }\n  set bg(bg) {\n    this.params.bg = bg;\n    this.clear();\n  }\n\n  get width() {\n    return this.params.width;\n  }\n  set width(width) {\n    this.params.width = width;\n    this.canvas.width = width;\n    this.clear();\n  }\n\n  get height() {\n    return this.params.height;\n  }\n  set height(height) {\n    this.params.height = height;\n    this.canvas.height = height;\n    this.clear();\n  }\n\n  /**\n   * @type {FractalFigure}\n   */\n  get figure() {\n    const alpha = Math.ceil(255 * (1 / this.iterations));\n\n    return this.params.figure.map(row => {\n      return row.map(point => {\n        if (Array.isArray(point)) {\n          return [(point[0] || 0), (point[1] || 0), (point[2] | 0), alpha];\n        } else if (point) {\n          return [255, 255, 255, alpha];\n        } else {\n          return [0, 0, 0, alpha];\n        }\n      });\n    });\n  }\n  set figure(figure) {\n    this.params.figure = figure;\n  }\n\n  get figureSize() {\n    return {\n      width: this.params.figure[0].length,\n      height: this.params.figure.length\n    };\n  }\n\n  get iterations() {\n    let ratio = this.params.ratio;\n    let iterations = 0;\n    const {width, height} = this.figureSize;\n\n    while (iterations < 100) {\n      ratio = Math.pow(this.params.ratio, iterations);\n\n      if (width * ratio > this.width || height * ratio > this.height) {\n        break;\n      } else {\n        iterations++;\n      }\n    }\n\n    return iterations;\n  }\n\n  get image() {\n    const { width, height } = this.figureSize;\n    const pixels = Uint8ClampedArray.from(this.figure.flat().flat());\n    const imgData = new ImageData(pixels, width, height);\n\n    const img = document.createElement('canvas');\n    img.width = width;\n    img.height = height;\n\n    const ctx = img.getContext('2d');\n\n    ctx.putImageData(imgData, 0, 0);\n\n    return img;\n  }\n\n  /**\n   * Return rgba()\n   * @param {number|number[]} r\n   * @param {number} g\n   * @param {number} b\n   * @param {number} a\n   * @returns {string}\n   */\n  rgba(r, g, b, a) {\n    if (Array.isArray(r)) [r, g, b, a] = r;\n    return `rgba(${r || 0}, ${g || 0}, ${b || 0}, ${a || 1})`;\n  }\n\n  getFigure(iteration = 1, image = this.image) {\n    const ratio = Math.pow(this.params.ratio, iteration);\n    const width = image.width * ratio;\n    const height = image.height * ratio;\n\n    const fig = document.createElement('canvas');\n    fig.width = width;\n    fig.height = height;\n\n    const ctx = fig.getContext('2d');\n\n    ctx.imageSmoothingEnabled = false;\n    ctx.drawImage(image, 0, 0, width, height);\n\n    return fig;\n  }\n\n  getPatttern(iteration = 0, image = this.image) {\n    const fig = this.getFigure(iteration, image);\n    return this.ctx.createPattern(fig, 'repeat');\n  }\n\n  /**\n   * Stop and clear screen\n   */\n  clear() {\n    this.stop();\n\n    this.iteration = 0;\n\n    this.ctx.fillStyle = this.rgba(this.params.bg);\n    this.ctx.clearRect(0, 0, this.width, this.height);\n    this.ctx.fillRect(0, 0, this.width, this.height);\n  }\n\n  /**\n   * Stop drawing\n   */\n  stop() {\n    // if (this._drawTO) clearTimeout(this._drawTO);\n    if (this._drawTO) cancelAnimationFrame(this._drawTO);\n  }\n\n  /**\n   * Start draw fractal\n   * @param {Function} callback\n   * @returns {HTMLCanvasElement}\n   */\n  draw() {\n    this.clear();\n\n    const iterations = this.iterations + 0;\n    const image = this.image;\n\n    const draw = callback => {\n      this._drawTO = requestAnimationFrame(() => {\n        const iteration = this._drawStep(image);\n\n        if (iteration < iterations) {\n          draw(callback);\n        } else {\n          callback(this.canvas);\n        }\n      });\n    };\n\n    return new Promise(resolve => {\n      draw(resolve);\n    });\n  }\n\n  _drawStep(image = this.image) {\n    const pattern = this.getPatttern(this.iteration, image);\n\n    this.ctx.fillStyle = pattern;\n    this.ctx.fillRect(0, 0, this.width, this.height);\n\n    return ++this.iteration;\n  }\n\n  step(iteration = this.iteration) {\n    const pattern = this.getPatttern(iteration, this.image);\n    this.ctx.fillStyle = pattern;\n    this.ctx.fillRect(0, 0, this.width, this.height);\n\n    return iteration + 1;\n  }\n\n  /**\n   * Return image blob of fractal\n   * @param {string} type\n   * @returns {Promise<Blob>}\n   */\n  getBlob(type = 'image/png') {\n    return new Promise(callback => {\n      this.canvas.toBlob(callback, type);\n    });\n  }\n}\n"],"names":[],"mappings":"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"}